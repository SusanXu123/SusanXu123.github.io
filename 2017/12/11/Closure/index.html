<!DOCTYPE html><html><head><meta charset="UTF-8"><title>理解闭包</title><link rel="stylesheet" href="http://obfnm2kw5.bkt.clouddn.com/normalize.css"><link rel="stylesheet" href="/css/hexo-theme-adoubi.css"><link rel="icon" href="/images/favicon.ico"></head><body><div class="header"><div class="header__title"><a href="/"><figure class="header__title__image"></figure></a></div><div class="header__archive"><a href="/archives"><figure class="header__archive__image"></figure><span class="header__archive__title">archive</span></a></div><div class="header__about"><a href="/about"><figure class="header__about__image"></figure><span class="header__about__title">about</span></a></div><div class="header__github"><a href="https://github.com/shinux" target="_blank"><figure class="header__github__image"></figure><span class="header__github__title">github</span></a></div><div class="header__feed"><a href="/atom.xml"><figure class="header__feed__image"></figure><span class="header__feed__title">feed</span></a></div><div class="header__notes"></div></div><div class="content"><div class="post-item"></div><h2 class="post-title-wrapper"><p class="post-title">理解闭包</p></h2><div class="post-date"><time datetime="2017-12-11T02:36:29.000Z">2017-12-11</time></div><div class="post-content"><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><p>闭包就是能够读取其他函数内部变量的函数。</p>
<h3 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h3><ol>
<li>可以读取函数内部的变量<br></li>
<li>这些变量的值始终保持在内存中<h3 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h3></li>
</ol>
<ul>
<li>外部函数 return 的是内部嵌套的函数</li>
<li>依赖于变量作用域<h3 id="几个函数"><a href="#几个函数" class="headerlink" title="几个函数"></a>几个函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scope = <span class="string">'global scope'</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkScope</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> scope = <span class="string">'local scope'</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> scope&#125;</div><div class="line">  <span class="keyword">return</span> f()</div><div class="line">&#125;</div><div class="line">checkScope() <span class="comment">// 'local scope'</span></div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scope = <span class="string">'global scope'</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkScope</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> scope = <span class="string">'local scope'</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> scope&#125;</div><div class="line">  <span class="keyword">return</span> f</div><div class="line">&#125;</div><div class="line">checkScope()() <span class="comment">// 'local scope'</span></div></pre></td></tr></table></figure>
<p>解析：<em>checkScope是f的父函数，f的存在依赖于checkScope，因此f执行的时候，checkScope会在内存中，不会在调用结束后，被垃圾回收机制（garbage collection）回收。</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scope = <span class="string">'global scope'</span></div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">  <span class="attr">scope</span> : <span class="string">'local scope'</span>,</div><div class="line">  <span class="attr">getNameFunc</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="keyword">this</span>.scope&#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">object.getNameFunc()() <span class="comment">//global scope</span></div></pre></td></tr></table></figure>
<p>解析：<em>每个函数调用都包含一个this值，如果闭包在外部函数里，是无法访问this的</em><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> scope = <span class="string">'global scope'</span></div><div class="line"><span class="keyword">var</span> object = &#123;</div><div class="line">  <span class="attr">scope</span> : <span class="string">'local scope'</span>,</div><div class="line">  <span class="attr">getNameFunc</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> that.scope&#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">object.getNameFunc()() <span class="comment">// local scope</span></div></pre></td></tr></table></figure></p>
<p><em>同样，闭包内无法直接访问外部函数的参数数组，除非外部函数能将参数数组保存到另外一个变量中</em></p>
</div></div><div class="footer"><div class="footer-copyright">Theme By <a href="https://github.com/shinux/hexo-theme-adoubi">Adoubi</a> , Powered By Hexo.</div></div></body></html>